<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Gamedev Canvas Workshop</title>
    <style>
      * {
        padding: 0;
        margin: 0;
      }
      canvas {
        background: #eee;
        display: block;
        margin: 0 auto;
        padding: 80px 0 0 120px;
      }
    </style>
  </head>
  <body>
    <canvas id="gameCanvas" width="800" height="800"></canvas>
    <script>
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");

      // 타일 크기 설정
      const TILE_SIZE = 60;

      // 맵 데이터 배열 (0: 빈공간, 1: 잔디, 2: 회색블록, 3: 갈색블록, 4: 빨간팀, 5: 파란팀, 6: 중앙박스, 7: 빨간옷 사람, 8: 파란옷 사람)
      const mapData = [
        [0, 1, 0, 0, 4, 4, 4, 0, 0, 1, 0],
        [0, 0, 0, 0, 7, 0, 7, 1, 0, 0, 0],
        [1, 1, 2, 2, 0, 7, 0, 3, 3, 1, 1],
        [1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 2, 2, 0, 3, 3, 0, 0, 1],
        [1, 0, 0, 1, 0, 6, 0, 1, 0, 0, 1],
        [1, 0, 0, 3, 3, 0, 2, 2, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1],
        [1, 3, 3, 0, 0, 8, 0, 2, 2, 1, 0],
        [0, 0, 1, 0, 8, 0, 8, 0, 2, 0, 0],
        [1, 0, 0, 0, 5, 5, 5, 0, 0, 0, 1],
      ];

      function drawMap() {
        mapData.forEach((row, y) => {
          row.forEach((tile, x) => {
            const posX = x * TILE_SIZE;
            const posY = y * TILE_SIZE;

            // 기본 배경
            ctx.fillStyle = "#FFC088";
            ctx.fillRect(posX, posY, TILE_SIZE, TILE_SIZE);

            switch (tile) {
              case 1: // 잔디
                ctx.fillStyle = "#4CAF50";
                ctx.fillRect(posX, posY, TILE_SIZE, TILE_SIZE);
                ctx.strokeStyle = "#388E3C";
                ctx.lineWidth = 8;
                for (let i = 0; i < 3; i++) {
                  for (let j = 0; j < 3; j++) {
                    const x = posX + (TILE_SIZE / 3) * i + 10;
                    const y = posY + (TILE_SIZE / 3) * j + 10;
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                    ctx.lineTo(x, y + 5);
                    ctx.stroke();
                  }
                }
                break;
              case 2: // 회색 블록
                ctx.fillStyle = "#9E9E9E";
                ctx.fillRect(posX, posY, TILE_SIZE, TILE_SIZE);
                ctx.strokeStyle = "#757575";
                ctx.lineWidth = 4;
                ctx.beginPath();
                ctx.moveTo(posX + 10, posY + 10);
                ctx.lineTo(posX + TILE_SIZE - 10, posY + TILE_SIZE - 10);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(posX + TILE_SIZE - 10, posY + 10);
                ctx.lineTo(posX + 10, posY + TILE_SIZE - 10);
                ctx.stroke();
                break;
              case 3: // 갈색 블록
                ctx.fillStyle = "#8D6E63";
                ctx.fillRect(posX, posY, TILE_SIZE, TILE_SIZE);
                ctx.strokeStyle = "#6D4C41";
                ctx.lineWidth = 3;
                for (let i = 1; i <= 3; i++) {
                  const x = posX + (TILE_SIZE / 4) * i;
                  ctx.beginPath();
                  ctx.moveTo(x, posY + 5);
                  ctx.lineTo(x, posY + TILE_SIZE - 5);
                  ctx.stroke();
                }
                for (let i = 1; i <= 2; i++) {
                  const y = posY + (TILE_SIZE / 3) * i;
                  ctx.beginPath();
                  ctx.moveTo(posX + 5, y);
                  ctx.lineTo(posX + TILE_SIZE - 5, y);
                  ctx.stroke();
                }
                break;
              case 4: // 빨간팀
                ctx.beginPath();
                ctx.arc(
                  posX + TILE_SIZE / 2,
                  posY + TILE_SIZE / 2,
                  TILE_SIZE / 3,
                  0,
                  Math.PI * 2
                );
                ctx.fillStyle = "rgba(33, 150, 243, 0.3)";
                ctx.fill();
                ctx.strokeStyle = "#F44336";
                ctx.lineWidth = 4;
                ctx.stroke();
                break;
              case 5: // 파란팀
                ctx.beginPath();
                ctx.arc(
                  posX + TILE_SIZE / 2,
                  posY + TILE_SIZE / 2,
                  TILE_SIZE / 3,
                  0,
                  Math.PI * 2
                );
                ctx.fillStyle = "rgba(33, 150, 243, 0.3)";
                ctx.fill();
                ctx.strokeStyle = "#2196F3";
                ctx.lineWidth = 4;
                ctx.stroke();
                break;
              case 6: // 중앙 박스
                ctx.fillStyle = "#795548";
                ctx.fillRect(
                  posX + TILE_SIZE / 4,
                  posY + TILE_SIZE / 4,
                  TILE_SIZE / 2,
                  TILE_SIZE / 2
                );
                break;
              case 7: // 빨간옷 사람
                ctx.fillStyle = "#F44336";
                ctx.fillRect(
                  posX + TILE_SIZE / 4,
                  posY + TILE_SIZE / 3,
                  TILE_SIZE / 2,
                  TILE_SIZE / 2
                );
                ctx.beginPath();
                ctx.arc(
                  posX + TILE_SIZE / 2,
                  posY + TILE_SIZE / 4,
                  TILE_SIZE / 6,
                  0,
                  Math.PI * 2
                );
                ctx.fillStyle = "#FFE0B2";
                ctx.fill();
                break;
              case 8: // 파란옷 사람
                ctx.fillStyle = "#2196F3";
                ctx.fillRect(
                  posX + TILE_SIZE / 4,
                  posY + TILE_SIZE / 3,
                  TILE_SIZE / 2,
                  TILE_SIZE / 2
                );
                ctx.beginPath();
                ctx.arc(
                  posX + TILE_SIZE / 2,
                  posY + TILE_SIZE / 4,
                  TILE_SIZE / 6,
                  0,
                  Math.PI * 2
                );
                ctx.fillStyle = "#FFE0B2";
                ctx.fill();
                break;
            }
          });
        });
      }

      const redPlayers = [];
      const bluePlayer = { x: 0, y: 0 };

      // 타일 상태 기억
      const originalTiles = Array(mapData.length).fill().map(() => Array(mapData[0].length).fill(0));

      // 초기 타일 상태 저장
      function saveOriginalTiles() {
        mapData.forEach((row, y) => {
          row.forEach((tile, x) => {
            if (tile !== 7 && tile !== 8) {  // 캐릭터가 아닌 타일만 저장
              originalTiles[y][x] = tile;
            }
          });
        });
      }

      // 초기 플레이어 위치 
      function findPlayers() {
        mapData.forEach((row, y) => {
          row.forEach((tile, x) => {
            if (tile === 7) {
              redPlayers.push({ x, y });
            } else if (tile === 8) {
              bluePlayer.x = x;
              bluePlayer.y = y;
            }
          });
        });
      }

      // 빨간옷 사람 이동 함수
      function moveRedPlayer(playerIndex, dx, dy) {
        const player = redPlayers[playerIndex];
        const newX = player.x + dx;
        const newY = player.y + dy;

        // 맵 범위 체크
        if (newX < 0 || newX >= mapData[0].length || newY < 0 || newY >= mapData.length) {
          return;
        }

        // 이동 가능한 타일인지 체크 (0: 빈공간, 1: 잔디)
        if (mapData[newY][newX] === 0 || mapData[newY][newX] === 1) {
          // 이전 위치를 원래 타일로 복원
          mapData[player.y][player.x] = originalTiles[player.y][player.x];
          // 새 위치에 플레이어 배치
          mapData[newY][newX] = 7;
          player.x = newX;
          player.y = newY;
          drawMap();
        }
      }

      // 파란옷 사람 이동 함수
      function moveBluePlayer(dx, dy) {
        const newX = bluePlayer.x + dx;
        const newY = bluePlayer.y + dy;

        // 맵 범위 체크
        if (newX < 0 || newX >= mapData[0].length || newY < 0 || newY >= mapData.length) {
          return;
        }

        // 이동 가능한 타일인지 체크 (0: 빈공간, 1: 잔디)
        if (mapData[newY][newX] === 0 || mapData[newY][newX] === 1) {
          // 이전 위치를 원래 타일로 복원
          mapData[bluePlayer.y][bluePlayer.x] = originalTiles[bluePlayer.y][bluePlayer.x];
          // 새 위치에 플레이어 배치
          mapData[newY][newX] = 8;
          bluePlayer.x = newX;
          bluePlayer.y = newY;
          drawMap();
        }
      }

      // 빨간옷 사람들 자동 이동 함수
      function moveRedPlayersRandomly() {
        const directions = [
          { dx: -1, dy: 0 },  // 왼쪽
          { dx: 1, dy: 0 },   // 오른쪽
          { dx: 0, dy: -1 },  // 위
          { dx: 0, dy: 1 }    // 아래
        ];
        
        redPlayers.forEach((_, index) => {
          const randomDirection = directions[Math.floor(Math.random() * directions.length)];
          moveRedPlayer(index, randomDirection.dx, randomDirection.dy);
        });
      }

      // 키보드 이벤트 처리
      document.addEventListener("keydown", (e) => {
        switch (e.key) {
          case "ArrowLeft":
            moveBluePlayer(-1, 0);
            break;
          case "ArrowRight":
            moveBluePlayer(1, 0);
            break;
          case "ArrowUp":
            moveBluePlayer(0, -1);
            break;
          case "ArrowDown":
            moveBluePlayer(0, 1);
            break;
        }
      });

      // 1초마다 빨간옷 사람들 자동 이동
      setInterval(moveRedPlayersRandomly, 1000);

      // 게임 초기화
      saveOriginalTiles();  // 초기 타일 상태 저장
      findPlayers();
      drawMap();
    </script>
  </body>
</html>